name: Run Postman Tests for Project

on:
  workflow_dispatch:
    inputs:
      project_name:
        description: 'Nome del progetto'
        required: true
        default: ''

jobs:
  run-tests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set variables for project files
        id: vars
        run: |
          echo "PROJECT=${{ github.event.inputs.project_name }}" >> $GITHUB_ENV
          echo "COLLECTION=projects/${{ github.event.inputs.project_name }}/Collection/${{ github.event.inputs.project_name }}.postman_collection.json" >> $GITHUB_ENV
          echo "DATA=projects/${{ github.event.inputs.project_name }}/Data/${{ github.event.inputs.project_name }}.json" >> $GITHUB_ENV
          echo "ENV=projects/${{ github.event.inputs.project_name }}/Environments/${{ github.event.inputs.project_name }}.postman_environment.json" >> $GITHUB_ENV

      - name: Show paths
        run: |
          echo "Collection path: $COLLECTION"
          echo "Data path: $DATA"
          echo "Environment path: $ENV"

      # Esempio: esecuzione test con Newman
      - name: Run Newman Tests
        uses: actions/setup-node@v3
      - run: |
          npm install -g newman
          newman run "$COLLECTION" \
            --environment "$ENV" \
            --iteration-data "$DATA"
