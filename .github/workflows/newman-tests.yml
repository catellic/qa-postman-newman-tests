name: Run Newman Tests

on:
  workflow_dispatch:
    inputs:
      collection:
        description: "Path to the Postman collection"
        required: true
        default: "collections/reqres.postman_collection.json"

      environment:
        description: "Path to the Postman environment file"
        required: true
        default: "environments/dev.postman_environment.json"

      data:
        description: "Path to data file (JSON or CSV)"
        required: true
        default: "data/data.json"

jobs:
  run-postman-tests:
    runs-on: ubuntu-latest

    steps:
    - name: â¬‡ï¸ Checkout repository
      uses: actions/checkout@v3

    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '20'

    - name: ğŸ“¦ Install Newman
      run: npm install -g newman

    - name: ğŸ“¦ Install Newman Reporter
      run: npm install -g newman-reporter-html

    - name: â–¶ï¸ Run Newman tests with HTML Report
      run: |
        newman run collections/reqres.postman_collection.json \
          -e environments/dev.postman_environment.json \
          -d data/data.json \
          -r cli,html \
          --reporter-html-export tests/report.html || true

    - name: ğŸ“¤ Upload HTML Report
      uses: actions/upload-artifact@v3
      with:
        name: newman-html-report
        path: tests/report.html
